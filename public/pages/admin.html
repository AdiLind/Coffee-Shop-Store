<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â˜• Coffee Shop - Admin Dashboard</title>
    <link rel="stylesheet" href="/css/themes.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/components.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>â˜• Admin Dashboard</h1>
            <p>Manage your coffee shop</p>
            
            <nav class="navbar">
                <div class="container">
                    <div class="nav-brand">
                        <a href="/pages/store.html">â˜• Coffee Shop</a>
                    </div>
                    <div class="nav-menu">
                        <a href="/pages/admin.html" class="active">Admin Panel</a>
                        <a href="/pages/admin-analytics.html">Analytics</a>
                        <a href="/pages/store.html">Store</a>
                        <div id="auth-section">
                            <a href="#" onclick="AuthManager.logout()">Logout</a>
                        </div>
                    </div>
                    <div class="theme-toggle-container">
                        <button id="theme-toggle" class="theme-toggle" title="Change Theme">ðŸŽ¨</button>
                    </div>
                </div>
            </nav>
        </header>
        
        <main class="main">
            <div class="admin-section">
                <div class="admin-stats">
                    <h2>Store Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Products</h3>
                            <p class="stat-number" id="totalProducts">9</p>
                        </div>
                        <div class="stat-card">
                            <h3>Total Users</h3>
                            <p class="stat-number" id="totalUsers">4</p>
                        </div>
                        <div class="stat-card">
                            <h3>Total Orders</h3>
                            <p class="stat-number" id="totalOrders">0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Revenue</h3>
                            <p class="stat-number" id="totalRevenue">$0</p>
                        </div>
                    </div>
                </div>
                
                <div class="admin-actions">
                    <h2>Admin Actions</h2>
                    <div class="actions-grid">
                        <button class="btn btn-primary admin-btn" data-action="products">Manage Products</button>
                        <button class="btn btn-primary admin-btn" data-action="users">View Users</button>
                        <button class="btn btn-primary admin-btn" data-action="orders">View Orders</button>
                        <button class="btn btn-primary admin-btn" data-action="activity">View Activity</button>
                    </div>
                </div>
                
                <div class="admin-forms">
                    <h2>Add New Product</h2>
                    <form id="addProductForm" class="admin-form">
                        <div class="form-group">
                            <label for="productTitle">Product Title</label>
                            <input type="text" id="productTitle" name="title" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" name="description" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="productPrice">Price ($)</label>
                            <input type="number" id="productPrice" name="price" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">Category</label>
                            <select id="productCategory" name="category" required>
                                <option value="">Select Category</option>
                                <option value="machines">Machines</option>
                                <option value="beans">Coffee Beans</option>
                                <option value="accessories">Accessories</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add Product</button>
                    </form>
                </div>
                
                <div id="adminMessage" class="message hidden"></div>
            </div>
        </main>
        
        <footer class="footer">
            <p>&copy; 2025 Coffee Shop. Premium coffee experience.</p>
        </footer>
    </div>
    
    <script src="/js/theme.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script>
        class AdminManager {
            constructor() {
                this.currentUser = null;
            }

            async init() {
                this.currentUser = AuthManager.currentUser;
                
                if (!this.currentUser || this.currentUser.role !== 'admin') {
                    window.location.href = '/pages/login.html';
                    return;
                }

                this.setupEventListeners();
                await this.loadAdminStats();
            }

            setupEventListeners() {
                // Admin action buttons
                document.querySelectorAll('.admin-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const action = e.target.getAttribute('data-action');
                        this.handleAdminAction(action);
                    });
                });

                // Add product form
                const addProductForm = document.getElementById('addProductForm');
                if (addProductForm) {
                    addProductForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleAddProduct(e.target);
                    });
                }
            }

            async loadAdminStats() {
                try {
                    const [productsRes, usersRes, ordersRes] = await Promise.all([
                        AuthManager.apiClient.get('/products'),
                        AuthManager.apiClient.get('/admin/users'),
                        AuthManager.apiClient.get('/admin/orders')
                    ]);

                    if (productsRes.success) {
                        document.getElementById('totalProducts').textContent = productsRes.data.length;
                    }
                    
                    if (usersRes.success) {
                        document.getElementById('totalUsers').textContent = usersRes.data.length;
                    }
                    
                    if (ordersRes.success) {
                        const orders = ordersRes.data;
                        document.getElementById('totalOrders').textContent = orders.length;
                        const revenue = orders.reduce((sum, order) => sum + (order.total || 0), 0);
                        document.getElementById('totalRevenue').textContent = formatCurrency(revenue);
                    }
                } catch (error) {
                    console.error('Failed to load admin stats:', error);
                }
            }

            handleAdminAction(action) {
                const messageDiv = document.getElementById('adminMessage');
                
                switch (action) {
                    case 'products':
                        window.location.href = '/pages/store.html';
                        break;
                    case 'users':
                        this.showMessage('Users management coming soon. Use Analytics for user insights.', 'info');
                        break;
                    case 'orders':
                        window.location.href = '/pages/my-orders.html';
                        break;
                    case 'activity':
                        window.location.href = '/pages/admin-analytics.html';
                        break;
                    default:
                        this.showMessage('Unknown action', 'error');
                }
            }

            async handleAddProduct(form) {
                const messageDiv = document.getElementById('adminMessage');
                const formData = new FormData(form);
                
                const product = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    price: parseFloat(formData.get('price')),
                    category: formData.get('category')
                };

                try {
                    const response = await AuthManager.apiClient.post('/products', product);
                    
                    if (response.success) {
                        this.showMessage('Product added successfully!', 'success');
                        form.reset();
                        await this.loadAdminStats();
                    } else {
                        this.showMessage(response.message || 'Failed to add product', 'error');
                    }
                } catch (error) {
                    console.error('Add product error:', error);
                    this.showMessage('Failed to add product', 'error');
                }
            }

            showMessage(message, type) {
                const messageDiv = document.getElementById('adminMessage');
                if (messageDiv) {
                    messageDiv.innerHTML = `<p class="${type}">${message}</p>`;
                    messageDiv.classList.remove('hidden');
                }
            }
        }

        // Initialize admin manager
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await AuthManager.init();
                const adminManager = new AdminManager();
                await adminManager.init();
            } catch (error) {
                console.error('Failed to initialize admin panel:', error);
            }
        });
    </script>
</body>
</html>